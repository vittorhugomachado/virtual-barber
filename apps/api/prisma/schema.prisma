generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model OwnerUser {
  id           Int      @id @default(autoincrement())
  email        String   @unique
  password     String
  createdAt    DateTime @default(now())
  updatedAt    DateTime? @updatedAt
  cnpj         String?  @db.Char(14)
  cpf          String?  @db.Char(11)
  refreshToken String?

  barberShop          BarberShop?
  passwordResetTokens PasswordResetToken[]

  @@index([cpf])
  @@index([cnpj])
  @@index([createdAt])
  @@map("owner_users")
}

model BarberUser {
  id          Int      @id @default(autoincrement())
  userName    String   @unique
  phoneNumber String?  @unique
  password    String
  createdAt   DateTime @default(now())
  barberShopId Int

  barberShop          BarberShop?      @relation(fields: [barberShopId], references: [id])
  appointments        Appointment[]
  passwordResetTokens PasswordResetToken[]

  @@map("barber_users")
}

model CustomerUser {
  id           Int      @id @default(autoincrement())
  userName     String
  phoneNumber  String   @unique
  createdAt    DateTime @default(now())
  barberShopId Int?

  appointments Appointment[]
  barberShop   BarberShop? @relation(fields: [barberShopId], references: [id])

  @@map("customer_users")
}

model BarberShop {
  id             Int      @id @default(autoincrement())
  userId         Int      @unique
  barbershopName String?
  slug           String   @unique
  phoneNumber    String?  @unique
  logoUrl        String?
  bannerUrl      String?
  isActive       Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime? @updatedAt

  user           OwnerUser    @relation(fields: [userId], references: [id], onDelete: Cascade)
  address        Address?
  services       Service[]
  openingHours   OpeningHour[]
  appointments   Appointment[]
  customerUsers  CustomerUser[]
  barberUsers    BarberUser[]

  @@index([isActive])
  @@index([createdAt])
  @@map("barbershops")
}

model OpeningHour {
  barbershopId Int
  day          WeekDay
  isOpen       Boolean @default(false)
  timeRanges   Json?

  barbershop BarberShop @relation(fields: [barbershopId], references: [id], onDelete: Cascade)

  @@id([barbershopId, day])
  @@map("opening_hours")
}

model Address {
  id           Int     @id @default(autoincrement())
  street       String
  number       String
  complement   String?
  neighborhood String
  city         String
  state        BrazilianState
  zipCode      String  @db.Char(8)
  latitude     Float?
  longitude    Float?
  barberShopId Int?    @unique
  createdAt    DateTime @default(now())
  updatedAt    DateTime? @updatedAt

  barberShop BarberShop? @relation(fields: [barberShopId], references: [id])

  @@map("addresses")
}

model PasswordResetToken {
  id        Int      @id @default(autoincrement())
  token     String   @unique
  userType  UserType
  ownerId   Int?
  barberId  Int?
  expiresAt DateTime
  createdAt DateTime @default(now())
  usedAt    DateTime?

  owner  OwnerUser?  @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  barber BarberUser? @relation(fields: [barberId], references: [id], onDelete: Cascade)

  @@index([token])
  @@index([expiresAt])
  @@map("password_reset_tokens")
}

model Service {
  id           Int      @id @default(autoincrement())
  name         String   @db.VarChar(100)
  image        String?
  description  String?
  duration     Int
  barbershopId Int
  createdAt    DateTime @default(now())
  isActive     Boolean  @default(true)

  barbershop   BarberShop    @relation(fields: [barbershopId], references: [id], onDelete: Cascade)
  appointments Appointment[]

  @@map("services")
}

model Appointment {
  id             Int               @id @default(autoincrement())
  barberShopId   Int
  customerUserId Int
  serviceId      Int
  notes          String?
  barberUserId   Int?
  status         AppointmentStatus @default(agendado)
  date           DateTime
  createdAt      DateTime          @default(now())

  barberShop   BarberShop   @relation(fields: [barberShopId], references: [id], map: "fk_appointment_barbershop")
  customerUser CustomerUser @relation(fields: [customerUserId], references: [id])
  service      Service      @relation(fields: [serviceId], references: [id])
  barberUser   BarberUser?  @relation(fields: [barberUserId], references: [id])

  @@map("appointments")
}

enum UserType {
  owner
  barber
}

enum BrazilianState {
  Acre
  Alagoas
  Amapá
  Amazonas
  Bahia
  Ceará
  Distrito_Federal
  Espírito_Santo
  Goiás
  Maranhão
  Mato_Grosso
  Mato_Grosso_do_Sul
  Minas_Gerais
  Pará
  Paraíba
  Paraná
  Pernambuco
  Piauí
  Rio_de_Janeiro
  Rio_Grande_do_Norte
  Rio_Grande_do_Sul
  Rondônia
  Roraima
  Santa_Catarina
  São_Paulo
  Sergipe
  Tocantins
}

enum WeekDay {
  segunda
  terca
  quarta
  quinta
  sexta
  sabado
  domingo
}

enum PaymentMethod {
  dinheiro
  cartao
  pix
}

enum AppointmentStatus {
  agendado
  finalizado
  cancelado_pelo_cliente
  cancelado_pela_barbearia
}
