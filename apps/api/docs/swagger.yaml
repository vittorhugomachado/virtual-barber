openapi: 3.0.0
info:
    title: Virtual Barber API
    version: 1.0.0
    description: API REST para gestão de barbearias.
    contact:
        email: ovitorhugoalvesmachado@gmail.com.br
    license:
        name: Vitor Hugo Alves Machado

tags:
    - name: Auth Owner User
    - name: Password Recovery
    - name: Owner User Data

paths:
    /api/owner-user/signup:
        post:
            tags:
                - Auth Owner User
            summary: Criar conta
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            type: object
                            properties:
                                barbershopName:
                                    type: string
                                    example: 'Barbearia Teste'
                                phoneNumber:
                                    type: string
                                    example: '(51) 98765-4321'
                                    description: Telefone com DDD
                                email:
                                    type: string
                                    format: email
                                    example: 'teste@barbearia.com.br'
                                password:
                                    type: string
                                    example: senhaForte123!
                                    description: >
                                        A senha deve ter entre 8 e 72 caracteres, conter pelo menos uma letra maiúscula e um número.
                            required: [barbershopName, phoneNumber, email, password]
            responses:
                '201':
                    description: Usuário criado com sucesso
                '409':
                    description: Email já cadastrado
                '422':
                    description: Erro de validação de campos
                '500':
                    description: Erro interno no servidor

    /api/owner-user/login:
        post:
            tags:
                - Auth Owner User
            summary: Entrar na conta
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            type: object
                            properties:
                                email:
                                    type: string
                                    format: email
                                    example: 'teste@barbearia.com.br'
                                password:
                                    type: string
                                    example: senhaForte123!
                            required: [email, password]
            responses:
                '200':
                    description: Login realizado com sucesso
                    headers:
                        Set-Cookie:
                            description: Cookies de autenticação definidos (token e refreshToken)
                            schema:
                                type: string
                            example: token=abc123; Path=/; HttpOnly; Max-Age=900
                '400':
                    description: Erro de validação de campos
                '401':
                    description: Credenciais inválidas
                '500':
                    description: Erro interno no servidor

    /api/owner-user/refresh-token:
        post:
            tags:
                - Auth Owner User
            summary: Atualizar token de acesso
            description: >
                Essa rota exige o cookie `refreshToken` presente na requisição. Ela retorna um novo access token no cookie `token`.
            responses:
                '200':
                    description: Token renovado com sucesso
                '401':
                    description: Token de atualização ausente ou inválido
                '500':
                    description: Erro interno no servidor

    /api/owner-user/logout:
        post:
            tags:
                - Auth Owner User
            summary: Sair da conta
            security:
                - bearerAuth: []
            description: Requer um access token válido no cookie ou header para remover sessão.
            responses:
                '200':
                    description: Logout efetuado com sucesso
                '401':
                    description: Usuário não autenticado
                '500':
                    description: Erro interno no servidor
    /api/owner-user/recover-password:
        post:
            tags:
                - Password Recovery
            summary: Solicitar recuperação de senha
            description: >
                Envia um email com link para redefinição de senha. O link contém um token único que expira em 1 hora.
                O email é enviado para o endereço cadastrado do usuário.
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            type: object
                            properties:
                                email:
                                    type: string
                                    format: email
                                    example: 'teste@barbearia.com.br'
                                    description: Email cadastrado na conta
                            required: [email]
            responses:
                '200':
                    description: Link de recuperação enviado com sucesso
                '400':
                    description: Email não fornecido
                '404':
                    description: Usuário não encontrado
                '500':
                    description: Erro interno no servidor

    /api/owner-user/validate-token/{token}:
        get:
            tags:
                - Password Recovery
            summary: Validar token de recuperação
            description: >
                Valida se o token de recuperação de senha é válido e não expirou.
                Esta rota é útil no frontend para renderizar o formulário de nova senha 
                apenas se o token for válido, ou mostrar página de erro caso contrário.
            parameters:
                - in: path
                  name: token
                  required: true
                  schema:
                      type: string
                      format: uuid
                      example: 'a1b2c3d4-e5f6-7890-abcd-ef1234567890'
                  description: Token UUID recebido por email
            responses:
                '200':
                    description: Token válido
                '400':
                    description: Token inválido (formato incorreto)
                '404':
                    description: Token não encontrado ou expirado
                '500':
                    description: Erro interno no servidor

    /api/owner-user/create-new-password/{token}:
        patch:
            tags:
                - Password Recovery
            summary: Redefinir senha
            description: >
                Redefine a senha do usuário usando o token válido recebido por email.
                Após redefinir a senha, o token é invalidado e não pode ser reutilizado.
            parameters:
                - in: path
                  name: token
                  required: true
                  schema:
                      type: string
                      format: uuid
                      example: 'a1b2c3d4-e5f6-7890-abcd-ef1234567890'
                  description: Token UUID recebido por email
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            type: object
                            properties:
                                newPassword:
                                    type: string
                                    example: 'NovaSenha123'
                                    description: >
                                        Nova senha. Requisitos:
                                        - Mínimo 8 caracteres
                                        - Máximo 72 caracteres
                                        - Pelo menos 1 letra maiúscula
                                        - Pelo menos 1 número
                            required: [newPassword]
            responses:
                '200':
                    description: Senha redefinida com sucesso
                '400':
                    description: Dados inválidos
                '404':
                    description: Token não encontrado ou expirado
                '422':
                    description: Erro de validação da senha
                '500':
                    description: Erro interno no servidor

    /api/owner-user/user:
        get:
            tags:
                - Owner User Data
            summary: Obter dados do usuário
            description: >
                Retorna todos os dados do usuário owner autenticado e sua barbearia associada.
                Requer autenticação via JWT token.
            security:
                - bearerAuth: []
            responses:
                '200':
                    description: Dados retornados com sucesso
                '401':
                    description: Não autenticado
                '404':
                    description: Usuário não encontrado
                '500':
                    description: Erro interno no servidor

        patch:
            tags:
                - Owner User Data
            summary: Atualizar dados do usuário
            description: >
                Atualiza os dados do usuário owner e/ou sua barbearia.
                Todos os campos são opcionais - envie apenas os que deseja atualizar.
                Requer autenticação via JWT token.
            security:
                - bearerAuth: []
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/UpdateUserRequest'
                        examples:
                            completo:
                                summary: Atualização completa
                                value:
                                    email: 'novoemail@barbearia.com.br'
                                    barbershopName: 'Barbearia Premium'
                                    phoneNumber: 51988776655
                                    address: 'Av. Principal, 456'
                                    cnpj: '98765432109876'
                                    cpf: '98765432109'
                                    logoUrl: 'https://example.com/new-logo.png'
                                    bannerUrl: 'https://example.com/new-banner.jpg'
                            parcial:
                                summary: Atualização parcial (só nome e telefone)
                                value:
                                    barbershopName: 'Novo Nome da Barbearia'
                                    phoneNumber: 51999998888
            responses:
                '200':
                    description: Dados atualizados com sucesso
                '400':
                    description: Dados inválidos
                '401':
                    description: Não autenticadoirado'
                '404':
                    description: Usuário ou barbearia não encontrada
                '500':
                    description: Erro interno no servidor

        delete:
            tags:
                - Owner User Data
            summary: Deletar conta do usuário
            description: >
                ⚠️ ATENÇÃO: Esta operação é IRREVERSÍVEL!
                
                Deleta permanentemente:
                - O usuário owner
                - A barbearia associada (cascade)
                - Todos os serviços da barbearia
                - Todos os agendamentos
                - Todos os dados relacionados
                
                Requer autenticação via JWT token.
            security:
                - bearerAuth: []
            responses:
                '200':
                    description: Usuário deletado com sucesso
                '401':
                    description: Não autenticado
                '404':
                    description: Usuário não encontrado
                '500':
                    description: Erro interno no servidor